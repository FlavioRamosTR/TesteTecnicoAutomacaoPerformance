# ğŸš€ Load Testing para E-commerce com k6, Python e Docker

Este projeto simula testes de carga em um banco de dados de e-commerce durante um cenÃ¡rio de pico (ex: Black Friday), utilizando:

- **k6**: OrquestraÃ§Ã£o de carga.
- **Python + ODBC**: Consultas e transaÃ§Ãµes no SQL Server.
- **Docker**: Ambiente isolado e reproduzÃ­vel.

---

## ğŸ“‹ PrÃ©-requisitos

- [Docker](https://docs.docker.com/get-docker/)
- [Docker Compose](https://docs.docker.com/compose/install/)

---

## ğŸš€ Como Executar

1. **Clone o repositÃ³rio**:

- Navegue o diretorio dos testes odbc 
   ```bash
   cd odbc
   ```

2. **Inicie o ambiente**:
   ```bash
   docker-compose up -d --build
   ```

3. **Acompanhe os logs**:
   ```bash
   docker-compose logs -f k6
   ```

4. **Parar e limpar**:
   ```bash
   docker-compose down
   ```

---

## ğŸ“‚ Estrutura do Projeto

```
ecommerce-load-test/
â”œâ”€â”€ docker-compose.yml          # ConfiguraÃ§Ã£o dos containers
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ Dockerfile             # Imagem do SQL Server
â”‚   â”œâ”€â”€ init.sql               # Dados iniciais (tabelas + produtos)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ ecommerce_db_test.py   # Script Python de testes
â”‚   â”œâ”€â”€ requirements.txt       # DependÃªncias Python
â”œâ”€â”€ k6/
â”‚   â”œâ”€â”€ ecommerce_k6_load.js   # ConfiguraÃ§Ã£o do k6
```

---

## ğŸ”§ ConfiguraÃ§Ã£o

### VariÃ¡veis de Ambiente
Crie um arquivo `.env` para personalizar credenciais:
```ini
DB_HOST=sql-server
DB_NAME=master
DB_USER=sa
DB_PASSWORD=123456
```

### Banco de Dados
Tabelas criadas automaticamente (via `init.sql`):
- **produtos**: CatÃ¡logo com 100 itens (20% em promoÃ§Ã£o).
- **estoque**: Quantidade disponÃ­vel por produto.
- **pedidos**: Registro de transaÃ§Ãµes.

---

## ğŸ“Š CenÃ¡rios de Teste

O k6 executa em 3 fases (definidas em `ecommerce_k6_load.js`):
1. **Rampa inicial**: 20 usuÃ¡rios em 2 minutos.
2. **Pico de carga**: 100 usuÃ¡rios em 5 minutos.
3. **Desligamento**: ReduÃ§Ã£o gradual em 2 minutos.

### Comportamento dos usuÃ¡rios virtuais (VUs):
- **100%** consultam o catÃ¡logo de promoÃ§Ãµes.
- **10%** simulam checkout (INSERT em pedidos + UPDATE em estoque).

---

## ğŸ›  Troubleshooting

| Problema                  | SoluÃ§Ã£o                                                                 |
|---------------------------|-------------------------------------------------------------------------|
| **ODBC Connection Failed**| Verifique se o SQL Server estÃ¡ saudÃ¡vel: `docker-compose logs sql-server` |
| **Script Python nÃ£o encontrado** | Confira o volume no `docker-compose.yml` (caminho `/python_scripts`) |
| **Deadlocks no banco**    | Aumente o intervalo entre transaÃ§Ãµes no k6 (adicione `sleep` no script). |

---

## ğŸ“ˆ Ajustes de Performance

Para aumentar a carga, edite as opÃ§Ãµes em `ecommerce_k6_load.js`:
```javascript
stages: [
  { duration: '1m', target: 50 },  // Rampa mais rÃ¡pida
  { duration: '10m', target: 200 }, // Pico maior
]
```

---

## ğŸ“Š MÃ©tricas Coletadas

### Banco de Dados:
- **Tempo de consulta** (SELECT).
- **Throughput de updates** (pedidos).

### k6:
- **Taxa de sucesso** (rate > 95%).
- **LatÃªncia p95**.

---

## ğŸ’¡ Melhorias Futuras

- Adicionar Grafana para visualizaÃ§Ã£o em tempo real.
- Implementar testes para APIs REST do e-commerce.
- Adicionar mais cenÃ¡rios (ex: concorrÃªncia em estoque).

---

## ğŸ“„ LicenÃ§a

MIT. Consulte o arquivo LICENSE.

---

## ğŸ”— Recursos Ãšteis

- [DocumentaÃ§Ã£o do k6](https://k6.io/docs/)
- [Guia pyODBC](https://github.com/mkleehammer/pyodbc/wiki)

---

Execute com `docker-compose up` e simule seu Black Friday! ğŸš€